{"version":3,"file":"ThemeProvider-eacd95b7.js","sources":["../../../../packages/ds/dist/components/ThemeProvider/ThemeController.js","../../../../packages/ds/dist/components/ThemeProvider/ThemeProvider.js"],"sourcesContent":["import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { createContext, useCallback, useLayoutEffect, useMemo, useState, } from 'react';\nexport const ThemeContext = createContext({\n    choice: 'light',\n    theme: undefined,\n    toggle: () => undefined,\n});\nconst isBrowser = () => typeof window !== 'undefined';\nexport const ThemeController = ({ light = 'light', dark = 'dark', choice = null, children, }) => {\n    var _a, _b;\n    const [themeChoice, setThemeChoice] = useState('light');\n    const [theme, setTheme] = useState();\n    const setThemeValues = useCallback((mode) => {\n        setThemeChoice(mode);\n        let darkMode = false;\n        switch (choice) {\n            case 'light':\n                darkMode = false;\n                break;\n            case 'dark':\n                darkMode = true;\n                break;\n            default:\n                darkMode = mode === 'dark';\n                break;\n        }\n        setTheme(darkMode ? dark : light || undefined);\n    }, [choice, dark, light]);\n    if (isBrowser()) {\n        (_a = window === null || window === void 0 ? void 0 : window.matchMedia) === null || _a === void 0 ? void 0 : _a.call(window, '(prefers-color-scheme: dark)').addEventListener('change', (e) => {\n            setThemeValues(e.matches ? 'dark' : 'light');\n        });\n        (_b = window === null || window === void 0 ? void 0 : window.matchMedia) === null || _b === void 0 ? void 0 : _b.call(window, '(prefers-color-scheme: light)').addEventListener('change', (e) => {\n            setThemeValues(e.matches ? 'light' : 'dark');\n        });\n    }\n    // paints the app before it renders elements\n    useLayoutEffect(() => {\n        const localTheme = window === null || window === void 0 ? void 0 : window.localStorage.getItem('themeChoice');\n        if (localTheme) {\n            setThemeValues(localTheme);\n        }\n        else if ((window === null || window === void 0 ? void 0 : window.matchMedia) &&\n            (window === null || window === void 0 ? void 0 : window.matchMedia('(prefers-color-scheme: dark)').matches)) {\n            setThemeValues('dark');\n        }\n        else {\n            setThemeValues('light');\n        }\n    }, [setThemeValues]);\n    const value = useMemo(() => {\n        const setMode = (mode) => {\n            if (isBrowser()) {\n                window === null || window === void 0 ? void 0 : window.localStorage.setItem('themeChoice', mode);\n            }\n            setThemeValues(mode);\n        };\n        return {\n            choice: themeChoice,\n            theme: theme,\n            toggle: () => {\n                if (themeChoice === 'light') {\n                    setMode('dark');\n                }\n                else {\n                    setMode('light');\n                }\n            },\n        };\n    }, [themeChoice, theme, setThemeValues]);\n    return _jsx(ThemeContext.Provider, { value: value, children: children });\n};\n","'use client';\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { cx } from '@committed/ds-ss';\nimport { useContext, useEffect, useRef } from 'react';\nimport { ThemeContext, ThemeController, } from './ThemeController';\n//------------------------ Utility hooks -----------------------------//\nexport const useThemeController = () => {\n    const { choice, toggle } = useContext(ThemeContext);\n    if (!toggle) {\n        throw new Error('useThemeController must be used within a ThemeProvider');\n    }\n    return [choice, toggle];\n};\nexport const useTheme = () => {\n    const context = useContext(ThemeContext);\n    if (!context) {\n        throw new Error('useTheme must be used within a ThemeProvider');\n    }\n    return [context.theme];\n};\n//--------------------------- main components ----------------------------------------//\nconst ControlledThemeProvider = ({ local = false, children, }) => {\n    const prevThemeRef = useRef();\n    const [theme] = useTheme();\n    useEffect(() => {\n        prevThemeRef.current = theme;\n        return () => {\n            if (theme) {\n                document.body.classList.remove(theme);\n            }\n        };\n    });\n    if (local) {\n        return (_jsx(\"div\", { className: cx('c-theme-provider', theme), \"data-testid\": \"theme-provider\", children: children }));\n    }\n    else {\n        const prevTheme = prevThemeRef.current;\n        if (prevTheme !== theme) {\n            if (prevTheme) {\n                document.body.classList.remove(prevTheme);\n            }\n            if (theme) {\n                document.body.classList.add(theme);\n            }\n        }\n        return _jsx(_Fragment, { children: children });\n    }\n};\n/**\n * The `ComponentsProvider`should wrap you application, it includes the `ThemeProvider`.\n *\n * By default it will switch from light to dark mode depending on the users preference determined by the\n * `prefers-color-scheme: dark` media query. You can fix the theme by setting the `choice` prop.\n *\n * The themes can be overridden using the exported `theme` function and set on the `light` and `dark` props.\n *\n * The `ThemeSwitch` component can also be used to switch the theme.\n */\nexport const ThemeProvider = (_a) => {\n    var { light, dark, choice } = _a, props = __rest(_a, [\"light\", \"dark\", \"choice\"]);\n    return (_jsx(ThemeController, { light: light, dark: dark, choice: choice, children: _jsx(ControlledThemeProvider, Object.assign({}, props)) }));\n};\n"],"names":["ThemeContext","createContext","isBrowser","ThemeController","light","dark","choice","children","_a","_b","themeChoice","setThemeChoice","useState","theme","setTheme","setThemeValues","useCallback","mode","darkMode","e","useLayoutEffect","localTheme","value","useMemo","setMode","_jsx","__rest","this","s","t","p","i","useThemeController","toggle","useContext","useTheme","context","ControlledThemeProvider","local","prevThemeRef","useRef","useEffect","cx","prevTheme","_Fragment","ThemeProvider","props"],"mappings":"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"}